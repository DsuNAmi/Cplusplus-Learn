# 优雅地断开套接字连接

### 基于TCP的半关闭

TCP的断开连接过程比建立连接过程更重要，因为连接过程中一般不会出现太大的问题，断开过程可能会发什么意向不到的情况。

##### 单方面断开连接带来的问题

`closesocket`函数意味着完全断开，既不能传输数据，也不能接收数据。

断开一部分连接是指，可以传输数据但无法接收，或可以接收数据但无法传输。

半关闭的函数：

```c++
int shutdown(SOCKET sock, int howto);
//成功时返回0，失败时返回SOCKET_ERROR
//sock->断开的套接字
//howto->断开方式的信息

//SD_RECEIVE	断开输入流
//SD_SEND		断开输出流
//SD_BOTH		断开I/O流
```



- 断开输入流：套接字无法接收数据，输入缓冲数据也会抹去，也不能调用输入相关函数。
- 断开输出流：套接字无法传输数据，输出缓冲的剩余数据会传输至目标主机。

