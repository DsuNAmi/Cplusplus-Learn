# 基于TCP的服务器端，客户端

##### TCP服务器端默认的函数调用顺序

1. `scoket`创建套接字
2. `bind`分配套接字地址
3. `listen`等待连接请求状态
4. `accpet`允许连接
5. `send/recv`数据交换
6. `close`断开连接

只用调用了 `listen`函数，客户端才能进入可发出连接请求的状态。第二个参数表示请求队列的长度。

服务器端处于等待连接请求状态，客户端请求连接时，受理连接前一直使请求处理等待状态。

`accept`函数受理连接请求等待队列中待处理的客户端连接请求。函数调用成功时，`accept`函数内部将产生用于数据I/O的套接字，并返回其文件描述符。需要强调的是，套接字是自动创建的并自动与发起连接请求的客户端建立连接。

##### TCP客户端的默认函数调用顺序

1. `socket`创建套接字
2. `connect`请求连接
3. `send/recv`交换数据
4. `close`关闭连接

客户端调用 `connect`函数后，发生以下情况之一才会返回：

- 服务器端接收连接情况
- 发生断网等异常情况而中断连接请求

需要注意的是，所谓的接受连接并不意味着服务器端调用 `accept`函数，其实是服务器端把连接请求信息记录到等待队列。所以 `connect`函数返回后并不立即进行数据交换。

## 实现回声ECHO服务器

客户端发什么，服务器回什么。

同一时刻只能服务于一个客户端。

基本运行方式：

- 服务器端在同一时刻只与一个客户端相连，并提供回声服务。
- 服务器端依次向5个客户端提供服务并退出。
- 客户端接收用户输入的字符串并发送到服务器端。
- 服务器端将接收的字符串数据传回客户端，即回声。
- 服务器端与客户端之间的字符串回声一直执行到客户端输入Q为止。

但是代码中给出的例子存在一些问题：

- 多次调用 `send`函数可能一次性发送到服务器端。
- 字符串太长了怎么办？
