# 计算机网络面试经验

### HTTP与HTTPS相关问题

#### HTTP

- HTTP协议构建于TCP/IP协议之上，是一个应用层协议，默认端口号是80。
- HTTP是无连接状态的（HTTP才加入 `keep-alive`）

###### HTTP的状态字

- 1XX表示信息，例如：100表示服务器同意信息处理。
- 2XX表示成功，例如：200表示请求成功，204表示没有内容。
- 3XX表示重定向，例如：301表示页面移动。
- 4XX表示客户端错误，例如：404表示页面找不到，403表示页面禁止。
- 5XX表示服务器错误，例如：500表示服务器内部错误，503表示服务器忙碌

| 状态码 |                                                                      解释                                                                      |
| :----: | :--------------------------------------------------------------------------------------------------------------------------------------------: |
|  200  |                                                               请求已经正常处理。                                                               |
|  204  |        请求处理成功，但是没有任何资源可以返回客户端，一般在只需要从客户端往服务器发送信息，而对客户端不需要发送新信息内容的情况下使用。        |
|  206  | 是对资源某一部分的请求，该状态码表示客户端进行了范围请求，而服务器成功执行了这部分的GET请求。响应报文中包含由Content-Range指定范围的实体内容。 |
|  301  |                                                        资源的URL已经更新，永久重定向。                                                        |
|  302  |                                代表的不是永久性移动，而是临时性移动。也就是说，已移动的URL未来还有可能发生改变                                |
|  304  |                                                        资源已找到，但是未符合条件请求。                                                        |
|  400  |                                                         服务器无法理解客户端发送的请求                                                         |
|  401  |                                                    表示发送的请求需要通过HTTP认证的认证信息                                                    |
|  403  |                                                              拒绝对请求资源的访问                                                              |
|  404  |                                                       服务器上没有请求的资源，路径错误等                                                       |
|  500  |                                    表明服务器在执行请求时发生了错误，也有可能是web应用存在bug或者是临时故障                                    |
|  503  |                                                                   服务器正忙                                                                   |

###### 条件GET

为了加速页面访问，HTTP使用了缓存机制，保存下页面的内容，当再次访问相同页面，服务器有两种策略：

1. **页面验证**：通过Expries头来判断页面内容是否已经更新，不需要访问服务器，高速有效，但是该方法存在一定的风险，也就是页面可能不提供Expries头。另外，浏览器可能会采用自启发的方法来判断内容是否更改，例如该页面一年未曾更改，则判断其在接下来的一年都不会更改。
2. **条件GET**：客户端向服务器发送一个查询包，服务器返回页面是否更改，如果没有更改，则直接从缓存取出页面。

###### 持久连接

HTTP是无连接、无状态的协议，其没发送一个请求就要建立一个TCP连接，这种做法速度缓慢，原因有两个:

1. TCP拥塞控制采用了慢启动，启动速度缓慢。
2. 多个TCP建立、释放需要浪费一定的时间以及系统开销。

因此在HTTP1.1协议，每个链接建立后不立即释放，如果之后还有请求则继续使用该链接，如果一定时间没有新的请求才释放链接，或者是链接太多才释放TCP链接。

###### 会话

定义：**客户端打开与服务器的连接发出请求到服务器响应客户端请求的全过程称为会话**。

会话跟踪：**对同一个用户对服务器的连续的请求和接收响应的监视。**

为什么需要会话跟踪？

浏览器与服务器之间的通信是通过HTTP协议进行通信的，而HTTP协议是无状态的协议，它不能保证客户的信息，即一次响应完成之后连接就断开了，下一次的请求需要重新连接，这样就需要判断是否是同一个用户，所以才会有会话跟踪技术来实现这种要求。

###### 会话跟踪

- **Cookie**：最常用的跟踪用户会话的方式，在客户端保持会话跟踪的解决方案，Cookie是以键值对形式存在片段信息，保存在客户端浏览器。当用户第一次请求服务时，Cookie信息会随着服务器端的响应发送给客户端浏览器，然后客户端浏览器会把Cookie保存起来，当下一次客户端再发起请求时携带此信息作为用户唯一标识发送服务器。
- **URL重写**：客户程序在每个URL的尾部添加一些额外数据（以键值对的形式传递），这些数据标识当前的会话，服务器将这个标识符与它存储的用户相关数据关联起来。例如：`http://192.168.1.1/jjhy;jsessionid=123455`
- **隐藏表单域**：隐藏表单域是利用HTML中的隐藏域，在网页表单内隐藏某些客户端的信息。在提交表单时，要将指定的名称和值自动包括在请求实体中，这些信息会随客户端的请求信息一起发送给服务器，服务器通过获取的这些信息来进行会话跟踪。

#### HTTPS

HTTPS = HTTP + SSL/TLS

全称：**Hypertext Transfer Protocol over Sercure  Socket Layer**，是以安全为目标的HTTP通道，简单讲是HTTP的安全版。即HTTP下加入SSL层，HTTPS的安全基础是SSL。

###### HTTPS的作用

**内容加密**：建立一个信息安全通道，来保证数据传输的安全

**身份认证**：确认网站的真实性

**数据完整性**：防止内容被第三方冒充或者篡改

###### HTTP和HTTPS的区别

HTTPS协议需要到CA申请证书；

HTTP是通过明文传输，HTTPS则是具有安全性的SSL加密传输协议；

两者是完全不同的连接方式，用的端口也不一样，HTTP是80， HTTPS是443。

###### HTTPS通信过程

服务器向证书颁发机构申请书，利用证书进行身份验证，防止黑客恶意冒充，然后利用对称加密进行内容加密，防止泄露：

1. 客户端向服务器发送请求`client hello`
   - 支持的版本协议：比如TLS1.0版。
   - 支持的压缩格式：比如ZIP。
   - 支持的加密算法：如RSA非对称加密。
   - 一个随机数：稍后用于生成密钥。
2. 服务器响应`server hello`
   - 确认使用的加密通信协议版本，比如TLS1.0版本。如果浏览器与服务器支持的版本不一致，服务器关闭加密通信。
   - SSL证书。
   - 一个服务器生成的随机数，稍后用于生成**对话密钥**。
   - 确认使用的加密算法。
3. 客户端回应
   - 根据SSL证书开始计算证书的真伪，判断证书的域名与颁发机构计算得到的是否一致，日期是否过期。
   - 产生最后一个随机数，**pre-master key**，该随机数用公钥进行加密传输给服务器，同时与前两个随机数一起通过一个密钥导出器最终导出一个对称密钥。
   - 加密协议改变通知：告知服务器加密方式已经发生了改变。
   - 客户端握手结束通知。
4. 服务器最后回应
   - 编码改变的通知：以后双方都用商定加密方式进行加密方法跟密钥的发送。
   - 服务器握手结束通知：这一项同时也是前面发送的所有内容的hash值，用来供客户端校验。

###### HTTPS的缺点

- HTTPS协议多次握手，导致页面的加载时间延长近50%
- HTTPS连接缓存不如HTTP高效，会增加数据开销和功耗。
- 申请SSL证书需要钱，公能越强大的证书费用越高。
- SSL涉及到的安全算法会消耗CPU资源，对服务器资源消耗较大。

###### 公钥加密计算量太大，如果减少耗用的时间？

每一次对话，客户端和服务器端都生成一个对话密钥，用它来加密信息。由于是对称加密方式，所以运算速度很快，而服务器公钥只用于加密 对话密钥 本身，这样就减少了加密运算的消耗时间。

###### 为什么一定要用三个随机数？

不管是客户端还是服务器，都需要随机数，这样生成的密钥才不会每次都一样。由于SSL协议中证书是静态的，因此十分有必要引入一种随机因素来保证协商出来的密钥的随机性。



对于RSA密钥交换算法来说，**pre-master key**本身就是一个随机数，再加上`hello`消息中的随机数，三个随机数通过一个密钥导出器最终导出一个对称密钥。



**pre-master key**的存在在于SSL协议不信任每个主机都能产生完全随机的随机数，如果随机数不随机，那么**pre-master secret**就有可能被猜出来了，那么仅适用**pre-master secret**作为密钥就不合适了，因此必须引入新的随机因素，那么客户端和服务器加上**pre-master secret**三个随机数一同生成的密钥就不同意被猜出来，一个伪随机可能完全不随机，可是三个伪随机就十分接近随机了，每增加一个自由度，随机性增加的可不是一。